<!DOCTYPE html><html lang=ar dir=rtl><head><meta charset=UTF-8><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>مهارات الكتابة</title><script src="https://cdn.tailwindcss.com"></script><style>@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap');*{box-sizing:border-box;margin:0;padding:0}body{font-family:Cairo,sans-serif;direction:rtl;background:#000;min-height:100vh;padding:10px}.container{max-width:900px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.2);overflow:hidden;border:2px solid #000}.header{background:#000;color:#fff;padding:20px;text-align:center;border-bottom:2px solid #fff}.header h1{font-size:2rem;margin-bottom:10px;font-weight:700}.header p{font-size:1rem;opacity:.9}.form-container{padding:30px 20px}.form-group{margin-bottom:20px}label{display:block;font-weight:600;margin-bottom:8px;color:#333;font-size:1rem}input[type=text],select,textarea{width:100%;padding:12px 15px;border:2px solid #000;border-radius:8px;font-size:16px;transition:all .3s ease;font-family:inherit;background:#fff}input[type=text]:focus,select:focus,textarea:focus{outline:none;border-color:#000;box-shadow:0 0 0 3px rgba(0,0,0,.1);transform:translateY(-1px)}textarea{resize:vertical;min-height:400px;height:400px;line-height:1.6}.submit-btn{background:#000;color:#fff;border:none;padding:15px 30px;border-radius:8px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .3s ease;width:100%;margin-top:20px}.submit-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.3)}.submit-btn:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none}.loading{display:none;text-align:center;padding:20px;color:#000;background:#f5f5f5;border-radius:8px;margin-top:20px}.result{display:none;margin-top:30px;padding:25px;background:#f8f9fa;border-radius:10px;border:2px solid #000}.result h3{color:#000;margin-bottom:15px;font-size:1.5rem;font-weight:700}.error{background:#fee;color:#800;border:2px solid red}.success{background:#efe;color:#080;border:2px solid #0a0}.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:20px 0}.metric-card{background:#fff;border:2px solid #000;border-radius:8px;padding:15px;text-align:center}.metric-title{font-size:.9rem;color:#666;margin-bottom:5px}.metric-value{font-size:1.8rem;font-weight:700;color:#000}.feedback-section{background:#fff;border:2px solid #000;border-radius:8px;padding:20px;margin-top:20px}.feedback-title{font-size:1.2rem;font-weight:600;color:#000;margin-bottom:15px}.feedback-content{line-height:1.8;color:#333;white-space:pre-wrap}.download-btn{background:#000;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s ease;margin-top:20px}.download-btn:hover:not(:disabled){background:#333;transform:translateY(-1px)}.word-counter{position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,.8);color:#fff;padding:5px 10px;border-radius:15px;font-size:.8rem;font-weight:500}.textarea-container{position:relative}.status-message{padding:15px;border-radius:8px;margin:15px 0;font-weight:500}.status-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}.status-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.status-loading{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}@media (max-width:768px){body{padding:5px}.container{border-radius:15px;margin:5px}.header{padding:15px}.header h1{font-size:1.5rem}.form-container{padding:20px 15px}.metrics-grid{grid-template-columns:1fr 1fr;gap:10px}.metric-value{font-size:1.4rem}textarea{min-height:200px}input[type=text],select,textarea{font-size:16px}}@media (max-width:480px){.metrics-grid{grid-template-columns:1fr}.header h1{font-size:1.3rem}.form-container{padding:15px 10px}}select{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:left 12px center;background-size:16px;padding-left:40px}button,select,input,textarea{min-height:44px}</style></head><body><div class=container><div class=header><h1>تقييم مهارات الكتابة</h1><p>التطوير الأسبوعي لمهارات الكتابة</p></div><div class=form-container><form id=writingForm><div class=form-group><label for=student_name>اسم الطالب</label><input type=text id=student_name name=student_name required placeholder="أدخل اسمك الكامل"></div><div class=form-group><label for=student_id>رقم الطالب</label><input type=text id=student_id name=student_id required placeholder="أدخل رقمك الجامعي"></div><div class=form-group><label for=title>عنوان المقال</label><input type=text id=title name=title required placeholder="اكتب عنواناً جذاباً لمقالك"></div><div class=form-group><label for=weekly_topic>المهارة الأسبوعية</label><select id=weekly_topic name=weekly_topic required><option value="1. همزة الوصل والقطع">1. همزة الوصل والقطع</option><option value="2. الهمزة في وسط الكلمة">2. الهمزة في وسط الكلمة</option><option value="3. الهمزة في آخر الكلمة">3. الهمزة في آخر الكلمة</option><option value="4. الحذف والزيادة">4. الحذف والزيادة</option><option value="5. الأخطاء الشائعة">5. الأخطاء الشائعة</option><option value="6. المعاجم العربية">6. المعاجم العربية</option><option value="7. علامات الترقيم وكتابة الفقرات">7. علامات الترقيم وكتابة الفقرات</option><option value="8. الكتابة الإبداعية">8. الكتابة الإبداعية</option><option value="9. المقالة">9. المقالة</option><option value="10. الكتابة الوظيفية: رسالة إدارية">10. الكتابة الوظيفية: رسالة إدارية</option><option value="11. الكتابة الوظيفية: السيرة">11. الكتابة الوظيفية: السيرة</option><option value="12. الكتابة الوظيفية: التلخيص">12. الكتابة الوظيفية: التلخيص</option><option value="13. كتابة التقارير">13. كتابة التقارير</option><option value="14. تطبيقات">14. تطبيقات</option></select></div><div class=form-group><label for=article>المقال (الحد الأدنى 100 كلمة):</label><div class=textarea-container><textarea id=article name=article required placeholder="اكتب مقالك هنا...

تأكد من:
- كتابة العنوان
- التركيز على المهارة الأسبوعية المختارة
- استخدام لغة عربية سليمة
- كتابة ما لا يقل عن 100 كلمة"></textarea><div class=word-counter id=wordCounter>0 كلمة</div></div></div><button type=submit class=submit-btn id=submitBtn>إرسال المقال للتقييم</button></form><div class=loading id=loading><h3>تحت التقييم</h3><p>يُرجى الانتظار</p></div><div class=result id=result></div></div></div><script>let a=null,b=null,c=!1;function countArabicWords(d){if(!d||"string"!=typeof d)return 0;let e=d.trim().split(/\s+/).filter(f=>{let g=f.replace(/[.,!?;:()""«»\-]/g,"");return g.length>0&&/[\u0600-\u06FF]/.test(g)});return e.length}function updateWordCounter(){let d=document.getElementById("article").value,e=countArabicWords(d),f=document.getElementById("wordCounter");f.textContent=`${e} كلمة`,e<100?f.style.background="rgba(220, 53, 69, 0.8)":f.style.background="rgba(40, 167, 69, 0.8)"}async function loadDocxLibrary(){return c&&"undefined"!=typeof docx?Promise.resolve():new Promise((d,e)=>{let f=document.createElement("script");f.src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js",f.onload=()=>{c=!0,d()},f.onerror=()=>e(new Error("Failed to load docx library")),document.head.appendChild(f)})}function createTextFile(){let d=`تقرير تقييم مهارات الكتابة

الطالب: ${a.student_name}
رقم الطالب: ${a.student_id}
عنوان المقال: ${a.title}
المهارة الأسبوعية: ${a.weekly_topic}

المقال الأصلي:
${a.article}

نتائج التقييم:
التقييم العام: ${b.gemini_rating||"غير متوفر"}/10
عدد الكلمات: ${b.word_count||0}
عدد الفقرات: ${b.paragraph_count||0}
التنوع المعجمي: ${parseFloat(b.lexical_diversity||0).toFixed(1)}%
الكثافة المعجمية: ${parseFloat(b.lexical_density||0).toFixed(1)}%

ملخص التقييم:
${b.feedback_summary||"غير متوفر"}

التقييم التفصيلي:
${b.gemini_feedback||"غير متوفر"}`,e=new Blob([d],{type:"text/plain;charset=utf-8"});downloadFile(e,"تقرير_الكتابة.txt")}async function createEnhancedDocx(){try{await loadDocxLibrary();let {Document:d,Packer:e,Paragraph:f,TextRun:g,AlignmentType:h}=docx;function createArabicParagraph(w,x=!1,y=!1,z=!1){let A=w.replace(/[:.]/g,"").trim(),B=y?{after:120}:z?{after:80}:{after:100},C=z?{left:400}:{};return new f({children:[new g({text:A,bold:x||y,font:{name:"Arial"},size:y?24:22,rightToLeft:!0})],alignment:h.BOTH,spacing:B,indent:C,bidirectional:!0})}function processBulletText(w){return w.replace(/^\*+\s*/,"• ").trim()}let i=`${a.student_name} (${a.student_id})`,j=a.weekly_topic,k=a.title,l=a.article,m=b.gemini_feedback||"غير متوفر",n=b.feedback_summary||"غير متوفر",o=m.split("\n").filter(w=>w.trim()),p=n.split("\n").filter(w=>w.trim()),q=[createArabicParagraph("المقال وتقرير التقييم",!0,!0),createArabicParagraph(`الطالب: ${i}`),createArabicParagraph(`الموضوع: ${j}`),new f({children:[],spacing:{after:400}}),createArabicParagraph("المقال الأصلي",!0,!0),createArabicParagraph(k,!0),createArabicParagraph(l),new f({children:[],spacing:{after:400}}),createArabicParagraph("تقرير التقييم",!0,!0),createArabicParagraph(`التقييم العام: ${b.gemini_rating||"غير متوفر"}/10`),createArabicParagraph(`عدد الكلمات: ${b.word_count||0}`),createArabicParagraph(`عدد الفقرات: ${b.paragraph_count||0}`),createArabicParagraph(`التنوع المعجمي: ${parseFloat(b.lexical_diversity||0).toFixed(1)}%`),createArabicParagraph(`الكثافة المعجمية: ${parseFloat(b.lexical_density||0).toFixed(1)}%`),createArabicParagraph("ملخص التقييم",!0,!0)];p.forEach(w=>{w.trim()&&(w.startsWith("*")||w.startsWith("-")?q.push(createArabicParagraph(processBulletText(w),!1,!1,!0)):w.includes(":")||w.length<50?q.push(createArabicParagraph(w,!0)):q.push(createArabicParagraph(w)))}),q.push(createArabicParagraph("التقييم التفصيلي",!0,!0)),o.forEach(w=>{w.trim()&&(w.startsWith("*")||w.startsWith("-")?q.push(createArabicParagraph(processBulletText(w),!1,!1,!0)):w.includes(":")||w.length<50?q.push(createArabicParagraph(w,!0)):q.push(createArabicParagraph(w)))});let r=new d({sections:[{properties:{page:{margin:{top:720,right:720,bottom:720,left:720}}},children:q}],styles:{default:{document:{run:{font:"Arial",size:22,rightToLeft:!0},paragraph:{alignment:h.RIGHT,bidirectional:!0}}}}}),s=await e.toBlob(r);downloadFile(s,"المقال_والتقرير.docx")}catch(d){console.error("حدث خطأ أثناء إنشاء المستند:",d),alert("حدث خطأ أثناء إنشاء المستند. سيتم إنشاء ملف نصي بدلاً من ذلك."),createTextFile()}}function downloadFile(d,e){let f=URL.createObjectURL(d),g=document.createElement("a");g.href=f,g.download=e,g.style.display="none",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(f)}function showStatus(d,e){let f=document.getElementById("loading");f.className=`status-message status-${e}`,f.innerHTML=`<div>${d}</div>`,f.style.display="block"}function displayResults(d){b=d;let e=document.getElementById("result");e.innerHTML=`<h3>نتائج التقييم</h3><div class=metrics-grid><div class=metric-card><div class=metric-title>التقييم العام</div><div class=metric-value>${d.gemini_rating||"غير متوفر"}/10</div></div><div class=metric-card><div class=metric-title>عدد الكلمات</div><div class=metric-value>${d.word_count||0}</div></div><div class=metric-card><div class=metric-title>عدد الفقرات</div><div class=metric-value>${d.paragraph_count||0}</div></div><div class=metric-card><div class=metric-title>التنوع المعجمي</div><div class=metric-value>${parseFloat(d.lexical_diversity||0).toFixed(1)}%</div></div><div class=metric-card><div class=metric-title>الكثافة المعجمية</div><div class=metric-value>${parseFloat(d.lexical_density||0).toFixed(1)}%</div></div></div><div class=feedback-section><div class=feedback-title>ملخص التقييم</div><div class=feedback-content>${d.feedback_summary||"لا يتوفر ملخص"}</div></div><div class=feedback-section><div class=feedback-title>التقييم التفصيلي</div><div class=feedback-content>${d.gemini_feedback||"لا يتوفر تقييم تفصيلي"}</div></div><div style="text-align: center;"><button class=download-btn onclick=createEnhancedDocx()>تحميل التقرير</button></div>`,e.className="result success",e.style.display="block"}window.createEnhancedDocx=createEnhancedDocx,document.getElementById("article").addEventListener("input",updateWordCounter),document.getElementById("writingForm").addEventListener("submit",async function(d){d.preventDefault();let e=new FormData(this),f=Object.fromEntries(e);if(!f.weekly_topic){showStatus("يرجى اختيار المهارة الأسبوعية","error");return}let g=countArabicWords(f.article);if(g<100){showStatus(`المقال يحتوي على ${g} كلمة فقط. الحد الأدنى المطلوب: 100 كلمة`,"error");return}a=f,showStatus("يتم إرسال المقال للتقييم...","loading"),document.getElementById("submitBtn").disabled=!0,document.getElementById("result").style.display="none";try{let h=await fetch("https://n8n-production-salm.up.railway.app/webhook/writing-skills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);let i=await h.json();showStatus("تم تقييم المقال بنجاح!","success"),displayResults(i)}catch(h){console.error("Error:",h),showStatus("حدث خطأ أثناء تقييم المقال. يرجى المحاولة مرة أخرى.","error")}finally{document.getElementById("submitBtn").disabled=!1}}),updateWordCounter()</script></body></html>
