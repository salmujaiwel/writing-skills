<!DOCTYPE html><html lang=ar dir=rtl><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>مهارات الكتابة</title><script>console.warn=function(){};</script><script src=https://cdn.tailwindcss.com></script><style>@import url(https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap);*{box-sizing:border-box;margin:0;padding:0}body{font-family:Cairo,sans-serif;direction:rtl;background:#000;min-height:100vh;padding:10px}.main-wrapper{max-width:800px;margin:0 auto;padding:0 16px}.container{background:#fff;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.2);overflow:hidden;border:2px solid #000}.header{background:#000;color:#fff;padding:14px;text-align:center;border-bottom:2px solid #fff}.header h1{font-size:1.6rem;margin-bottom:6px;font-weight:700}.header p{font-size:.9rem;opacity:.9}.form-container{padding:20px 16px}.form-group{margin-bottom:12px}label{display:block;font-weight:600;margin-bottom:4px;color:#333;font-size:.9rem}input[type=text],select,textarea{width:100%;padding:8px 10px;border:2px solid #000;border-radius:8px;font-size:14px;transition:all .3s ease;font-family:inherit;background:#fff}input[type=text]:focus,select:focus,textarea:focus{outline:0;border-color:#000;box-shadow:0 0 0 3px rgba(0,0,0,.1);transform:translateY(-1px)}textarea{resize:vertical;min-height:300px;height:300px;line-height:1.6}.submit-btn{background:#000;color:#fff;border:none;padding:10px 20px;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .3s ease;width:100%;margin-top:12px}.submit-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.3)}.submit-btn:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none}.loading{display:none;text-align:center;padding:16px;color:#000;background:#f5f5f5;border-radius:8px;margin-top:16px}.result{display:none;margin-top:20px;padding:18px;background:#f8f9fa;border-radius:10px;border:2px solid #000}.result h3{color:#000;margin-bottom:10px;font-size:1.3rem;font-weight:700}.error{background:#fee;color:#800;border:2px solid red}.success{background:#efe;color:#080;border:2px solid #0a0}.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin:14px 0}.metric-card{background:#fff;border:2px solid #000;border-radius:8px;padding:10px;text-align:center}.metric-title{font-size:.85rem;color:#666;margin-bottom:4px}.metric-value{font-size:1.6rem;font-weight:700;color:#000}.section-card{background:#fff;border-radius:10px;padding:14px;margin-bottom:14px;border-right:4px solid #667eea}.section-card.summary{background:#eff6ff;border-right-color:#3b82f6}.section-card.priority-errors{background:#fff5f5;border-right-color:#dc3545}.section-card.other-errors{background:#fff5f5;border-right-color:#dc3545}.section-card.analysis{background:#f0f9ff;border-right-color:#0ea5e9}.section-card.tips{background:#fffbeb;border-right-color:#f59e0b}.section-title{font-size:1.05rem;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:6px}.section-title.priority{color:#dc3545}.section-title.analysis-title{color:#0ea5e9}.section-title.tips-title{color:#f59e0b}.section-content{line-height:1.7;color:#374151;font-size:.95rem}.error-box{background:#fff;border:1px solid #fecaca;border-radius:8px;padding:10px;margin-bottom:8px}.error-box:last-child{margin-bottom:0}.error-label{font-weight:700;color:#1f2937;font-size:.9rem;margin-bottom:4px}.error-text{color:#4b5563;font-size:.9rem;margin-bottom:4px}.error-highlight{color:#dc3545;font-weight:700;background:#fff5f5;padding:2px 5px;border-radius:3px}.rule-box{background:#dbeafe;border-right:3px solid #3b82f6;padding:10px;border-radius:6px;margin-top:8px;font-size:.85rem;color:#1e40af}.numbered-item{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;padding:8px;background:#fff;border-radius:8px}.numbered-item:last-child{margin-bottom:0}.number-badge{background:#3b82f6;color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:700;flex-shrink:0}.number-badge.tip{background:#f59e0b}.item-text{flex:1;color:#374151;font-size:.9rem;line-height:1.6}.download-btn{background:#000;color:#fff;border:none;padding:10px 20px;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .3s ease;margin-top:16px}.download-btn:hover:not(:disabled){background:#333;transform:translateY(-1px)}.word-counter{position:absolute;bottom:8px;left:8px;background:rgba(0,0,0,.8);color:#fff;padding:4px 8px;border-radius:12px;font-size:.75rem;font-weight:500}.textarea-container{position:relative}.status-message{padding:12px;border-radius:8px;margin:12px 0;font-weight:500}.status-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}.status-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.status-loading{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}@media (max-width:768px){body{padding:5px}.main-wrapper{padding:0 8px}.container{border-radius:12px}.header{padding:12px}.header h1{font-size:1.4rem}.form-container{padding:16px 12px}.metrics-grid{grid-template-columns:1fr 1fr;gap:8px}.metric-value{font-size:1.3rem}textarea{min-height:200px}input[type=text],select,textarea{font-size:15px}}@media (max-width:480px){.metrics-grid{grid-template-columns:1fr}.header h1{font-size:1.2rem}.form-container{padding:12px 8px}}select{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:left 12px center;background-size:16px;padding-left:40px}button,select,input,textarea{min-height:44px}</style></head><body><div class=main-wrapper><div class=container><div class=header><h1>تقييم مهارات الكتابة</h1><p>التطوير الأسبوعي لمهارات الكتابة</p></div><div class=form-container><form id=writingForm><div class=form-group><label for=student_name>اسم الطالب</label><input type=text id=student_name name=student_name required placeholder="أدخل اسمك الكامل"></div><div class=form-group><label for=student_id>رقم الطالب</label><input type=text id=student_id name=student_id required placeholder="أدخل رقمك الجامعي"></div><div class=form-group><label for=title>عنوان المقال</label><input type=text id=title name=title required placeholder="اكتب عنواناً جذاباً لمقالك"></div><div class=form-group><label for=weekly_topic>المهارة الأسبوعية</label><select id=weekly_topic name=weekly_topic required><option value="1. همزة الوصل والقطع">1. همزة الوصل والقطع</option><option value="2. الهمزة في وسط الكلمة">2. الهمزة في وسط الكلمة</option><option value="3. الهمزة في آخر الكلمة">3. الهمزة في آخر الكلمة</option><option value="4. الحذف والزيادة">4. الحذف والزيادة</option><option value="5. الأخطاء الشائعة">5. الأخطاء الشائعة</option><option value="6. المعاجم العربية">6. المعاجم العربية</option><option value="7. علامات الترقيم وكتابة الفقرات">7. علامات الترقيم وكتابة الفقرات</option><option value="8. الكتابة الإبداعية">8. الكتابة الإبداعية</option><option value="9. المقالة">9. المقالة</option><option value="10. الكتابة الوظيفية: رسالة إدارية">10. الكتابة الوظيفية: رسالة إدارية</option><option value="11. الكتابة الوظيفية: السيرة">11. الكتابة الوظيفية: السيرة</option><option value="12. الكتابة الوظيفية: التلخيص">12. الكتابة الوظيفية: التلخيص</option><option value="13. كتابة التقارير">13. كتابة التقارير</option><option value="14. تطبيقات">14. تطبيقات</option></select></div><div class=form-group><label for=article>المقال (الحد الأدنى 100 كلمة):</label><div class=textarea-container><textarea id=article name=article required placeholder="اكتب مقالك هنا..."></textarea><div class=word-counter id=wordCounter>0 كلمة</div></div></div><button type=submit class=submit-btn id=submitBtn>إرسال المقال للتقييم</button></form><div class=loading id=loading><h3>تحت التقييم</h3><p>يُرجى الانتظار</p></div><div class=result id=result></div></div></div></div><script>let a=null,b=null,c=!1;function countArabicWords(d){if(!d||"string"!=typeof d)return 0;let e=d.trim().split(/\s+/).filter(f=>{let g=f.replace(/[.,!?;:()""«»\-]/g,"");return g.length>0&&/[\u0600-\u06FF]/.test(g)});return e.length}function updateWordCounter(){let d=document.getElementById("article").value,e=countArabicWords(d),f=document.getElementById("wordCounter");f.textContent=`${e} كلمة`,e<100?f.style.background="rgba(220, 53, 69, 0.8)":f.style.background="rgba(40, 167, 69, 0.8)"}async function loadDocxLibrary(){return c&&"undefined"!=typeof docx?Promise.resolve():new Promise((d,e)=>{let f=document.createElement("script");f.src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js",f.onload=()=>{c=!0,d()},f.onerror=()=>e(new Error("Failed to load docx library")),document.head.appendChild(f)})}function createTextFile(){let d=`تقرير تقييم مهارات الكتابة\n\nالطالب: ${a.student_name}\nرقم الطالب: ${a.student_id}\nعنوان المقال: ${a.title}\nالمهارة الأسبوعية: ${a.weekly_topic}\n\nالمقال الأصلي:\n${a.article}\n\nنتائج التقييم:\nالتقييم العام: ${b.gemini_rating||"غير متوفر"}/10\nعدد الكلمات: ${b.word_count||0}\nعدد الفقرات: ${b.paragraph_count||0}\nالتنوع المعجمي: ${parseFloat(b.lexical_diversity||0).toFixed(1)}%\nالكثافة المعجمية: ${parseFloat(b.lexical_density||0).toFixed(1)}%\n\nملخص التقييم:\n${b.feedback_summary||"غير متوفر"}\n\nالتقييم التفصيلي:\n${b.gemini_feedback||"غير متوفر"}`,e=new Blob([d],{type:"text/plain;charset=utf-8"});downloadFile(e,"تقرير_الكتابة.txt")}async function createEnhancedDocx(){try{await loadDocxLibrary();let{Document:d,Packer:e,Paragraph:f,TextRun:g,AlignmentType:h}=docx;function createArabicParagraph(w,x=!1,y=!1,z=!1){let A=w.replace(/[:.]/g,"").trim(),B=y?{after:120}:z?{after:80}:{after:100},C=z?{left:400}:{};return new f({children:[new g({text:A,bold:x||y,font:{name:"Arial"},size:y?24:22,rightToLeft:!0})],alignment:h.BOTH,spacing:B,indent:C,bidirectional:!0})}function processBulletText(w){return w.replace(/^\*+\s*/,"• ").trim()}let i=`${a.student_name} (${a.student_id})`,j=a.weekly_topic,k=a.title,l=a.article,m=b.gemini_feedback||"غير متوفر",n=b.feedback_summary||"غير متوفر",o=m.split("\n").filter(w=>w.trim()),p=n.split("\n").filter(w=>w.trim()),q=[createArabicParagraph("المقال وتقرير التقييم",!0,!0),createArabicParagraph(`الطالب: ${i}`),createArabicParagraph(`الموضوع: ${j}`),new f({children:[],spacing:{after:400}}),createArabicParagraph("المقال الأصلي",!0,!0),createArabicParagraph(k,!0),createArabicParagraph(l),new f({children:[],spacing:{after:400}}),createArabicParagraph("تقرير التقييم",!0,!0),createArabicParagraph(`التقييم العام: ${b.gemini_rating||"غير متوفر"}/10`),createArabicParagraph(`عدد الكلمات: ${b.word_count||0}`),createArabicParagraph(`عدد الفقرات: ${b.paragraph_count||0}`),createArabicParagraph(`التنوع المعجمي: ${parseFloat(b.lexical_diversity||0).toFixed(1)}%`),createArabicParagraph(`الكثافة المعجمية: ${parseFloat(b.lexical_density||0).toFixed(1)}%`),createArabicParagraph("ملخص التقييم",!0,!0)];p.forEach(w=>{w.trim()&&(w.startsWith("*")||w.startsWith("-")?q.push(createArabicParagraph(processBulletText(w),!1,!1,!0)):w.includes(":")||w.length<50?q.push(createArabicParagraph(w,!0)):q.push(createArabicParagraph(w)))}),q.push(createArabicParagraph("التقييم التفصيلي",!0,!0)),o.forEach(w=>{w.trim()&&(w.startsWith("*")||w.startsWith("-")?q.push(createArabicParagraph(processBulletText(w),!1,!1,!0)):w.includes(":")||w.length<50?q.push(createArabicParagraph(w,!0)):q.push(createArabicParagraph(w)))});let r=new d({sections:[{properties:{page:{margin:{top:720,right:720,bottom:720,left:720}}},children:q}],styles:{default:{document:{run:{font:"Arial",size:22,rightToLeft:!0},paragraph:{alignment:h.RIGHT,bidirectional:!0}}}}}),s=await e.toBlob(r);downloadFile(s,"المقال_والتقرير.docx")}catch(d){console.error("حدث خطأ أثناء إنشاء المستند:",d),alert("حدث خطأ أثناء إنشاء المستند. سيتم إنشاء ملف نصي بدلاً من ذلك."),createTextFile()}}function downloadFile(d,e){let f=URL.createObjectURL(d),g=document.createElement("a");g.href=f,g.download=e,g.style.display="none",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(f)}function showStatus(d,e){let f=document.getElementById("loading");f.className=`status-message status-${e}`,f.innerHTML=`<div>${d}</div>`,f.style.display="block"}function highlightErrors(d){return d.replace(/"([^"]+)"/g,'<span class="error-highlight">$1</span>')}function parseFeedbackSections(d){let e={summary:"",skillErrors:[],otherErrors:[],analysis:[],tips:[]};if(!d)return e;let f=d.split(/\n/),g="summary",h="";for(let i of f){let j=i.trim();if(!j){h&&(g==="skillErrors"||g==="otherErrors"?e[g].push(h):g==="analysis"||g==="tips"?e[g].push(h):e.summary+=h+"\n",h="");continue}if(j.includes("**الأخطاء المتعلقة بـ")||j.includes("**(الأولوية)")){h&&e.summary&&(e.summary+=h+"\n"),g="skillErrors",h="";continue}if(j.includes("**أخطاء لغوية أخرى")){h&&e.skillErrors.length>0&&e.skillErrors.push(h),g="otherErrors",h="";continue}if(j.includes("**تحليل المهارة اللغوية")){h&&e.otherErrors.length>0&&e.otherErrors.push(h),g="analysis",h="";continue}if(j.includes("**نصائح للتحسين")){h&&e.analysis.length>0&&e.analysis.push(h),g="tips",h="";continue}if(j.startsWith("**")||j.startsWith("•")||j.startsWith("-"))continue;h+=j+" "}return h&&(g==="skillErrors"||g==="otherErrors"?e[g].push(h):g==="analysis"||g==="tips"?e[g].push(h):e.summary+=h),e}function displayResults(d){b=d;let e=parseFeedbackSections(d.gemini_feedback||""),f=document.getElementById("result");f.innerHTML=`<h3>نتائج التقييم</h3><div class=metrics-grid><div class=metric-card><div class=metric-title>التقييم العام</div><div class=metric-value>${d.gemini_rating||"غير متوفر"}/10</div></div><div class=metric-card><div class=metric-title>عدد الكلمات</div><div class=metric-value>${d.word_count||0}</div></div><div class=metric-card><div class=metric-title>عدد الفقرات</div><div class=metric-value>${d.paragraph_count||0}</div></div><div class=metric-card><div class=metric-title>التنوع المعجمي</div><div class=metric-value>${parseFloat(d.lexical_diversity||0).toFixed(1)}%</div></div><div class=metric-card><div class=metric-title>الكثافة المعجمية</div><div class=metric-value>${parseFloat(d.lexical_density||0).toFixed(1)}%</div></div></div>`;if(e.summary){f.innerHTML+=`<div class="section-card summary"><div class=section-title>ملخص التقييم</div><div class=section-content>${highlightErrors(e.summary)}</div></div>`}if(e.skillErrors.length>0){let g='<div class="section-card priority-errors"><div class="section-title priority">الأخطاء المتعلقة بالمهارة (الأولوية)</div>';e.skillErrors.forEach(h=>{g+=`<div class=error-box>${highlightErrors(h)}</div>`}),g+="</div>",f.innerHTML+=g}if(e.otherErrors.length>0){let g='<div class="section-card other-errors"><div class=section-title>أخطاء لغوية أخرى (إن وُجدت)</div>';e.otherErrors.forEach(h=>{g+=`<div class=error-box>${highlightErrors(h)}</div>`}),g+="</div>",f.innerHTML+=g}if(e.analysis.length>0){let g='<div class="section-card analysis"><div class="section-title analysis-title">تحليل المهارة اللغوية</div>',h=1;e.analysis.forEach(i=>{g+=`<div class=numbered-item><div class=number-badge>${h}</div><div class=item-text>${highlightErrors(i)}</div></div>`,h++}),g+="</div>",f.innerHTML+=g}if(e.tips.length>0){let g='<div class="section-card tips"><div class="section-title tips-title">نصائح للتحسين</div>',h=1;e.tips.forEach(i=>{g+=`<div class=numbered-item><div class="number-badge tip">${h}</div><div class=item-text>${i}</div></div>`,h++}),g+="</div>",f.innerHTML+=g}!e.summary&&0===e.skillErrors.length&&0===e.otherErrors.length&&0===e.analysis.length&&0===e.tips.length&&(f.innerHTML+=`<div class=section-card><div class=section-title>التقييم التفصيلي</div><div class=section-content>${highlightErrors(d.gemini_feedback||"لا يتوفر تقييم تفصيلي")}</div></div>`),f.innerHTML+=`<div style=text-align:center><button class=download-btn onclick=createEnhancedDocx()>تحميل التقرير</button></div>`,f.className="result success",f.style.display="block"}window.createEnhancedDocx=createEnhancedDocx,document.getElementById("article").addEventListener("input",updateWordCounter),document.getElementById("writingForm").addEventListener("submit",async function(d){d.preventDefault();let e=new FormData(this),f=Object.fromEntries(e);if(!f.weekly_topic){showStatus("يرجى اختيار المهارة الأسبوعية","error");return}let g=countArabicWords(f.article);if(g<100){showStatus(`المقال يحتوي على ${g} كلمة فقط. الحد الأدنى المطلوب: 100 كلمة`,"error");return}a=f,showStatus("يتم إرسال المقال للتقييم...","loading"),document.getElementById("submitBtn").disabled=!0,document.getElementById("result").style.display="none";try{let h=await fetch("https://n8n-production-salm.up.railway.app/webhook/writing-skills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);let i=await h.json();showStatus("تم تقييم المقال بنجاح!","success"),displayResults(i)}catch(h){console.error("Error:",h),showStatus("حدث خطأ أثناء تقييم المقال. يرجى المحاولة مرة أخرى.","error")}finally{document.getElementById("submitBtn").disabled=!1}}),updateWordCounter()</script></body></html>
